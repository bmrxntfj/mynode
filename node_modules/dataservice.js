exports.run=function(context){
	try{
		invokeMethod(context);
	}
	catch(e){
		context.response.write(JSON.stringify({success:false,errors:e}));
		context.response.end();
	}
}

function invokeMethod(context){
	var arr=context.params.pathname.split('/');
	var mName=arr[arr.length-1];
	var dsName=arr[arr.length-2];
	//console.log(dsName+' - '+mName);
	var ds=require('../server/'+dsName+'.js');
	//console.log('require dataservice');
	var method=ds[mName];
	if(!method){context.response.write(mName+" method can't find!");return;}
	//console.log('invoke method');
	method(context.params,function(result){
		if(result===undefined||result==null){result={};}
		if(result.success===undefined){result.success=true;}
		var d=JSON.stringify(result);
		//console.log(d);
		if(result){context.response.write(d);}
		context.response.end();
	});
}
